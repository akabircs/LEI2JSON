<!DOCTYPE html>
<html lang="en">
   <head>
      <meta charset="UTF-8">
      <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" />
      <style>
         body {
         font-family: Arial, sans-serif;
         background-color: #f7f7f7;
         }
         h1 {
         margin: 5px 0;
         text-align: center;
         font-size: 18px;
         }
         label {
         display: block;
         margin-bottom: 10px;
         font-weight: bold;
         font-size: 14px;
         }
         /* Style for the username and password fields */
         #username,
         #password {
         width: 90%;
         padding: 10px;
         border: none;
         border-radius: 12px;
         background-color: #f1f1f1;
         margin-bottom: 20px;
         }
         /* Square frame for the username and password fields */
         .login-field {
         display: flex;
         justify-content: center;
         align-items: center;
         height: 50px;
         background-color: #ddd;
         border-radius: 12px;
         margin-bottom: 10px;
         }
         /* Style for the rest of the fields */
         input[type="text"],
         input[type="email"],
         input[type="tel"],
         input[type="password"]:not(#username):not(#password),
         select {
         width: 90%;
         padding: 10px;
         border: none;
         border-radius: 12px;
         background-color: #f1f1f1;
         margin-bottom: 20px;
         }
         /* Focus style for the rest of the fields */
         input[type="text"]:focus,
         input[type="email"]:focus,
         input[type="tel"]:focus,
         select:focus,
         input[type="password"]:not(#username):not(#password):focus {
         outline: none;
         box-shadow: 0 0 5px #6dd5fa;
         }
         input[type="submit"],
         input[type="button"] {
         display: block;
         width: 90%;
         background-color: #4CAF50;
         color: white;
         padding: 14px 20px;
         margin: 20px 0;
         border: none;
         border-radius: 12px;
         cursor: pointer;
         }
         input[type="submit"]:hover,
         input[type="button"]:hover {
         background-color: #3e8e41;
         }
         .material-icons {
         vertical-align: middle;
         font-size: 28px;
         margin-left: 10px;
         }
         #error-message {
         color: red;
         margin-bottom: 10px;
         font-weight: bold;
         }
         select {
         font-size: 16px;
         padding: 10px;
         border: none;
         border-radius: 25px;
         box-shadow: 0px 1px 3px rgba(0, 0, 0, 0.2);
         background-color: #f0f0f0;
         color: #555;
         outline: none;
         }
         select option {
         padding: 10px;
         background-color: #fff;
         color: #555;
         }
         select optgroup {
         font-weight: bold;
         background-color: #ccc;
         color: #555;
         }
         #loading {
         display: none;
         position: fixed;
         top: 0;
         left: 0;
         width: 100%;
         height: 100%;
         background-color: rgba(0, 0, 0, 0.5);
         z-index: 9999;
         }
         #loading-bar {
         position: absolute;
         top: 50%;
         left: 50%;
         transform: translate(-50%, -50%);
         width: 100px;
         height: 10px;
         background-color: #f7f7f7;
         border-radius: 12px;
         overflow: hidden;
         }
         #loading-bar:before {
         content: "";
         display: block;
         position: absolute;
         top: 0;
         left: 0;
         width: 100%;
         height: 100%;
         background-color: #4CAF50;
         animation: loading-bar 2s linear infinite;
         }
         @keyframes loading-bar {
         from {
         transform: translateX(-100%);
         }
         to {
         transform: translateX(100%);
         }
         }
.tab {
  overflow: hidden;
  border: 3px solid #ccc;
  background-color: #f1f1f1;
  border-radius: 12px; /* Rounded corners for the tab container */
  padding: 5px 5px;
}

/* Style the buttons that are used to open the tab content */
.tab button {
  background-color: inherit;
  float: left;
  border: none;
  outline: none;
  cursor: pointer;
  padding: 5px 5px;
  transition: 0.3s;
  border-radius: 10px; /* Rounded corners for each button */
  margin-right: 2px;
}

/* Change background color of buttons on hover */
.tab button:hover {
  background-color: #ddd;
}

/* Create an active/current tablink class */
.tab button.active {
  background-color: #ccc;
}

/* Style the tab content */
.tabcontent {
  display: none;
  padding: 6px 12px;
  border: 2px solid #ccc;
  
  border-radius: 12px; /* Rounded corners for the tab content */
  margin-top: 20px;
  padding-top: 20px;
}

         .nav-button {
            background-color: #4CAF50; /* Green */
            border: none;
            color: white;
            padding: 14px 20px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            margin: 20px 10px;
            cursor: pointer;
            border-radius: 12px;
            transition: background-color 0.3s, transform 0.3s;
         }
         .nav-button:disabled {
         background-color: #aaa;
         cursor: not-allowed;
         }
         .nav-buttons-container {
         display: flex;
         justify-content: space-between;
         align-items: center;
         margin: 20px 0;
         }
         .nav-buttons-container .nav-button {
         background-color: #4CAF50;
         color: white;
         padding: 14px 20px;
         margin: 0 10px;
         border: none;
         border-radius: 12px;
         cursor: pointer;
         }
         .nav-buttons-container .nav-button:disabled {
         background-color: #aaa;
         cursor: not-allowed;
         }
        .nav-button:hover {
          background-color: #45a049;
          transform: scale(1.05);
        }

        .scrollable-container {
  width: 90%;
  height: 200px; /* Adjust the height as needed */
  overflow: auto; /* Enable scroll */
  border: 1px solid #ccc;
  padding: 10px;
  box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.1); /* Shadow for depth */
  background-color: #f9f9f9; /* Light background color */
}


/* Button Styles */
.button {
  background-color: #4CAF50; /* Green */
  border: none;
  color: white;
  padding: 14px 20px;
  text-align: center;
  text-decoration: none;
  display: inline-block;
  margin: 10px 10px;
  cursor: pointer;
  border-radius: 12px;
  transition: background-color 0.3s, transform 0.3s;
}

.button:hover {
  background-color: #45a049;
  transform: scale(1.05);
}

.button:disabled {
  background-color: #ccc;
  cursor: not-allowed;
}

      </style>
   </head>
   <body>
      <div id="loading">
         <div id="loading-bar"></div>
      </div>
      <div class="tab">
         <button class="tablinks active" onclick="openTab(event, 'Producer')" id="defaultOpen">Producer</button>
         <button class="tablinks" onclick="openTab(event, 'Event')">Event</button>
         <button class="tablinks" onclick="openTab(event, 'Generated_JSON')">Generated<br>JSON</button>
         <button class="tablinks" onclick="openTab(event, 'Validation_Result')">Validation<br>Result</button>
      </div>
      <div id="Producer" class="tabcontent" style="display: block;">
         <h1>Producer Data <i class="material-icons">account_box</i>
         </h1>
         <label for="fullname" >Full name:</label>
         <input type="text" id="fullname" name="fullname" placeholder="Your full name..." value="<?= name ?>">
         <br>
         <label for="email" >Email:</label>
         <input type="email" id="email" name="email" placeholder="Your email address..." value="<?= email ?>" required>
         <div id="email-error-message" style="color: red;"></div>
         <script>
            var emailInput = document.getElementById("email");
                  var emailErrorMessage = document.getElementById("email-error-message");
            
                  emailInput.addEventListener("input", function(event) {
                  var email = event.target.value;
                  if (!isValidEmail(email)) {
                  emailErrorMessage.textContent = "Invalid email address.";
                  } else {
                  emailErrorMessage.textContent = "";
                  }
                  });
            
                  function isValidEmail(email) {
                  var regex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                  return regex.test(email);
                  }
         </script>
         <label for="address" >Address:</label>
         <input type="text" id="address" name="address" placeholder="Your address..." value="<?= address ?>" >
         <label for="phone" >Phone:</label>
         <input type="tel" id="phone" name="phone" placeholder="Your phone number..." oninput="validateNumbers(this)" value="<?= phone ?>">
         <script>
            function validateNumbers(input) {
                input.value = input.value.replace(/[^0-9+]/g, ''); // Remove all characters that are not numbers
                        if ((input.value.match(/\+/g) || []).length > 1 || (input.value.indexOf('+') > 0)) {
                    input.value = input.value.replace(/\+/g, '');
                }
            }
         </script>
         <br>
      </div>
      <div id="Event" class="tabcontent" >
         <h1>Event Data <i class="material-icons">event_note</i>
         </h1>
         <label for="piccode" >PIC code:</label>
         <input type="text" id="piccode" name="piccode" placeholder="Your PIC code..." aria-describedby="piccode-description" required value="A123ABCD">
         <label for="myFile">Select a JSON file:</label>
         <input type="file" id="myFile" name="myFile" accept=".json"><br><br>
         <label for="event">Event Name:</label>
         <input type="text" id="eventName" disabled>
         <p id="error" style="display: none; color: red;">Please select a file and an event.</p>
         <input type="button" id="clearButton" onclick="clearData()" value="Reset" class="button">
         <script>
            function showLoading() {
               document.getElementById("loading").style.display = "block";
            }
            
            function hideLoading() {
               document.getElementById("loading").style.display = "none";
            }
            
            function onEventChange() {
               // Do something when the event select is changed
            }
            
            function selectFile() {
               var fileInput = document.getElementById("myFile");
               var file = fileInput.files[0];
               var errorMessage = document.getElementById("error");
               
               if (!file) {
                  //errorMessage.style.display = "block";
                  return;
               }
               
               errorMessage.style.display = "none";
               showLoading();
               
               var reader = new FileReader();
               reader.onload = function(e) {
                  var content = e.target.result;
                  google.script.run.withSuccessHandler(function(result) {
                     document.getElementById("eventName").value = result;
                     hideLoading();
                  }).template(content);
               };
               reader.readAsText(file);
            }
            
            function clearData() {
             showLoading();
               // Clear the file input
               document.getElementById("myFile").value = "";
            
               // Clear the event name
               document.getElementById("eventName").value = "";
            
               // Clear the error message
               document.getElementById("error").style.display = "none";
            
               // Clear the Google Spreadsheet data (you need to implement this)
               google.script.run.withSuccessHandler(function() {
                  // Hide the loading bar after the operation is finished
                  hideLoading();
               }).clearSpreadsheet();
            }
            
            // add event listeners to hide the error message when a file or an event is selected
            document.getElementById("myFile").addEventListener("change", function() {
               document.getElementById("error").style.display = "none";
               selectFile();
            });
            
            document.getElementById("event").addEventListener("change", function() {
               document.getElementById("error").style.display = "none";
            });
         </script>
         <script type="text/javascript">
            function showLoading() {
              document.getElementById("loading").style.display = "block";
            }
            
            function hideLoading() {
              document.getElementById("loading").style.display = "none";
            }


            function update_json_data(message) {
              document.getElementById("json_data").innerHTML = message;
            }

            function generateMessage() {
              var eventName = document.getElementById('eventName').value;
              if (!eventName) {
                  document.getElementById('error').style.display = 'block';
                  return;
              }
              showLoading();
              google.script.run.withSuccessHandler(function(returnValue) {
              hideLoading();
              update_json_data(returnValue[0]);
              navigate(returnValue[1]);
              })
              .generateMessage(document.getElementById('fullname').value, document.getElementById('piccode').value, document.getElementById('email').value, document.getElementById('phone').value, document.getElementById('address').value, document.getElementById('eventName').value);
            }
         </script>
      </div>
      <div id="Generated_JSON" class="tabcontent">
         <h1>JSON Data</h1>
         <div class="scrollable-container">
            <p id="json_data">JSON data will be displayed here.</p>
         </div>
      </div>
      <div id="Validation_Result" class="tabcontent">
        <h1>Validation Result</h1>
        <div class="scrollable-container">
          <p id="validation_result">Validation result will be displayed here.</p>
        </div>
        <br>
        <h1>Save Options</h1>
        <button id="copyButton" onclick="copyJSON()" class="button" disabled>Copy<br>JSON</button>
        <button id="downloadButton" onclick="downloadJSON()" class="button" disabled>Downlaod<br>JSON</button>
        <button id="saveGoogleDriveButton" onclick="saveToGoogleDrive()" class="button" disabled>Save to<br>Google Drive</button>

        <script type="text/javascript">
        function showLoading() {
          document.getElementById("loading").style.display = "block";
        }
        
        function hideLoading() {
          document.getElementById("loading").style.display = "none";
        }


        function validate_json_data(message) {
          document.getElementById("validation_result").innerHTML = message;

          // Enable or disable buttons based on validation result
          var copyButton = document.getElementById("copyButton");
          var downloadButton = document.getElementById("downloadButton");
          var saveGoogleDriveButton = document.getElementById("saveGoogleDriveButton");

          if (message === "valid") {
            copyButton.removeAttribute("disabled");
            downloadButton.removeAttribute("disabled");
            saveGoogleDriveButton.removeAttribute("disabled");
          } else {
            copyButton.setAttribute("disabled", "true");
            downloadButton.setAttribute("disabled", "true");
            saveGoogleDriveButton.setAttribute("disabled", "true");
          }
        }


        function validateMessage() {
          
          showLoading();
          google.script.run.withSuccessHandler(function(returnValue) {
          hideLoading();
          validate_json_data(returnValue);
          })
          .validate(document.getElementById('json_data').innerText);
        }

        function copyJSON() {
          var log="";
          for (let i = 0; i < 11; i++) {
          var startTime = performance.now();
          var textToCopy = document.getElementById("json_data").innerText;
          navigator.clipboard.writeText(textToCopy).then(function() {
            //alert('JSON text successfully copied to clipboard');
          }).catch(function(err) {
            console.error('Unable to copy text to clipboard', err);
          });
            var endTime = performance.now();
            var executionTime = endTime - startTime;
            log+=executionTime+"\n"
          }
          alert('Execution time: \n' + log + ' milliseconds');
        }


        function downloadJSON() {
          var log="";
          for (let i = 0; i < 11; i++) {
          var startTime = performance.now();
          var textToSave = document.getElementById("json_data").innerText;
          var blob = new Blob([textToSave], { type: "application/json" });
          var url = URL.createObjectURL(blob);

          var a = document.createElement("a");
          a.href = url;
          a.download = "data.json"; // You can name your file here
          document.body.appendChild(a);
          a.click();
          var endTime = performance.now();
            var executionTime = endTime - startTime;
            log+=executionTime+"\n"
            
          document.body.removeChild(a);
          }
          alert('Execution time: \n' + log + ' milliseconds');
        }


        function saveToGoogleDrive() {
          showLoading();
          var textToSave = document.getElementById("json_data").innerText;
          google.script.run
            .withSuccessHandler(function(message) {
              // Show a dialog upon success
              hideLoading();
              alert(message);

            })
            .withFailureHandler(function(error) {
              // Show a dialog upon failure
              alert("Failed to save file: " + error);
            })
            .saveToGoogleDrive(textToSave);
        }

      </script>
      </div>
      <script>
         var currentTab = 0; // Variable to track the current tab
         
          function navigate(direction) {
             var tabcontent = document.getElementsByClassName("tabcontent");
             var tablinks = document.getElementsByClassName("tablinks");
             
             // Hide the current tab
             tabcontent[currentTab].style.display = "none";
             tablinks[currentTab].classList.remove("active");
             
             // Move to the next or previous tab
             currentTab += direction;
             
             // Make sure the currentTab is within the valid range
             if (currentTab < 0) currentTab = 0;
             if (currentTab >= tabcontent.length) currentTab = tabcontent.length - 1;
             
             // Show the new tab
             tabcontent[currentTab].style.display = "block";
             tablinks[currentTab].classList.add("active");
         
             updateButtons();
          }
          // Update the back and next buttons based on the current tab
          function updateButtons() {
             var backButton = document.getElementById("backButton");
             var nextButton = document.getElementById("nextButton");
         
             if (currentTab === 0) {
                backButton.disabled = true;  // Disable back button on the first tab
             } else {
                backButton.disabled = false; // Enable back button on other tabs
             }
         
              if (currentTab === 3) { 
                  //nextButton.value = "Save";
                  //nextButton.onclick = function() { };
                  nextButton.disabled = true;
              } else {
                nextButton.disabled = false;
                if (currentTab === 2) { 
                  nextButton.value = "Validate";
                  nextButton.onclick = function() { validateMessage(); navigate(1); };
              } else if (currentTab === 1) {
              nextButton.value = "Generate JSON"; 
              nextButton.onclick = function() {generateMessage(); };
              //nextButton.disabled = true;  // Disable next button on the last tab
            } else {
              //nextButton.disabled = false; // Enable next button on other tabs
              nextButton.value = "Next";
              nextButton.onclick = function() { navigate(1); };
            }
              }
          }
      </script>
      <br>
      <div class="nav-buttons-container">
         <!-- <button class="nav-button" onclick="navigate(-1)" id="backButton" disabled><i class="material-icons">arrow_back</i>Back</button>
            <button class="nav-button" onclick="navigate(1)" id="nextButton">Next<i class="material-icons">arrow_forward</i></button> -->
         <input type="button" id="backButton" onclick="navigate(-1)" value="Back" class="nav-button" disabled>
         <input type="button" id="nextButton" onclick="navigate(1)" value="Next" class="nav-button">
      </div>
   </body>
</html>
